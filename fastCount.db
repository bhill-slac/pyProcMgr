record(calc, "$(P)Rate$(N)")
{
	field( INPA, "$(P)Rate$(N).LB NPP NMS" )   # Prev counter (Last B)
	field( INPB, "$(P)Count$(N) NPP NMS" )     # Current counter
	field( INPC, "1.0" )                   # Delta time (sec)
	field( INPD, "$(P)Rate$(N).VAL NPP NMS" )  # Previous rate
	field( INPE, "$(RATE_SMOOTH=0.0)" )    # Smoothing factor
	field( CALC, "(D*E)/C+MAX(0,B-A)*(1-E)/C" )
	field( PREC, "2" )
	field( EGU,  "Hz" )
	field( SCAN, "1 second" )
}

record(calcout, "$(P)Count$(N)")
{
    field(PINI, "YES")
#   field(INPA, "$(P)Count$(N)")
	field(VAL,  "1")
    field(CALC, "VAL>=1000000?0:VAL+1")
    field(PREC, "0")
#   field(MDEL, "-1")
	field(ODLY, "0.017")
#	field(ODLY, "5")
	field(OUT,  "$(P)Count$(N).PROC CA")
    field(FLNK, "$(P)CircBuff$(N)")
}

record(compress, "$(P)CircBuff$(N)")
{
    field( INP, "$(P)Count$(N)")
    field(NSAM, "$(NELM=500)")
    #info(Q:group, {
    #    "$(P)iq":{"I": {+channel:"VAL"}}
    #})
#	field( FLNK, "$(P)drive$(N)" )
}

record( calcout, "$(P)drive$(N)" )
{
#	field(INPA, "$(P)Count$(N) CPP")
    field(CALC, "A")
	field(ODLY, "0.017")
#	field(ODLY, "5")
	field(OUT,  "$(P)Count$(N).PROC")
}
